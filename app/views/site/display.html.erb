<button><a href="/upload">Upload code</a></button>
<%= @message %>

<canvas id="canvas" width="900" height="500"></canvas>

<script>

  $(document).on('ready', function(){
    var width = $(window).width();
    var height = $(window).height();

    var canvas = document.getElementById('canvas');
    canvas.width = width;
    canvas.height = height;

    var c = canvas.getContext("2d");

    c.fillStyle = 'black';
    c.font="bold 30px Arial";

    // c.fillStyle = '0076A8';
    // c.beginPath();
    // c.moveTo(0, height);
    // c.lineTo(0, height - 50);
    // c.quadraticCurveTo(400, 560, 700, 620);
    // c.quadraticCurveTo(1000, 700, 1300, 550);
    // c.lineTo(width, height);
    // c.stroke();
    // c.fill();

    var circleHeight = height / 2;
    var textHeight = height / 2 - 140;
    var lightWidth = width / 2 - 350;
    var temperatureWidth = width / 2;
    var soundWidth = width / 2 + 350;

    var text = "Light";
    var textWidth = c.measureText(text).width;
    c.fillText("Light", lightWidth - textWidth/2, textHeight);

    text = "Temperature";
    textWidth = c.measureText(text).width;
    c.fillText("Temperature", temperatureWidth - textWidth/2, textHeight);
    
    text = "Sound";
    textWidth = c.measureText(text).width;
    c.fillText("Sound", soundWidth - textWidth/2, textHeight);

    c.fillStyle = '0010C2';
    c.beginPath();
    c.arc(lightWidth, circleHeight, 90, 0, Math.PI * 2, true);
    c.fill();

    c.beginPath();
    c.arc(temperatureWidth, circleHeight, 90, 0, Math.PI * 2, true);
    c.fill();

    c.beginPath();
    c.arc(soundWidth, circleHeight, 90, 0, Math.PI * 2, true);
    c.fill();

    setInterval(function ajaxCall() {
      $.ajax({
        type: 'GET',
        url: '/input.json',
        async: true,
        success: function(data){
          console.log("Light: " + data.light);
          console.log("Temperature: " + data.temperature);
          console.log("Sound: " + data.sound);
          updateLight(data.light);
          updateTemperature(data.temperature);
          updateSound(data.sound);
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) { 
          console.log("Status: " + textStatus);
          console.log("Error: " + errorThrown); 
        }
      })
    }, 100);

    function updateLight(light) {
      // take a range in 400 in 1000
      // convert it to 4561 to 1336


      switch(true)
      {
      case (light >= 900): // 1336
        c.fillStyle = 4561;
        break;
      case (light < 900 && light >= 800):
        c.fillStyle = 4561;
        break;
      case (light < 800 && light >= 700):
        c.fillStyle = 1336;
        break;
      case (light < 700 && light >= 600):
        c.fillStyle = 1336;
        break;
      case (light < 600 && light >= 500): 
        c.fillStyle = 1336; // 4561
        break;
      default:
        c.fillStyle = 1336;
      }

      c.beginPath();
      c.arc(lightWidth, circleHeight, 90, 0, Math.PI * 2, true);
      c.fill();
    };

    function updateTemperature(temp) {
      switch(true)
      {
      case (temp >= 147):
        c.fillStyle = 'C4BAFF';
        break;
      case (temp < 147 && temp >= 145):
        c.fillStyle = 'A291FF';
        break;
      case (temp < 145 && temp >= 143):
        c.fillStyle = '765EFF';
        break;
      case (temp < 143 && temp >= 141):
        c.fillStyle = '4529E3';
        break;
      case (temp < 141 && temp >= 139):
        c.fillStyle = '3016C4';
        break;
      default:
        c.fillStyle = 'black';
      }

      c.beginPath();
      c.arc(temperatureWidth, circleHeight, 90, 0, Math.PI * 2, true);
      c.fill();
    };

      function updateSound(sound) {
      switch(true)
      {
      case (sound >= 34):
        c.fillStyle = '3016C4';
        break;
      default:
        c.fillStyle = 'C4BAFF';
      }

      c.beginPath();
      c.arc(soundWidth, circleHeight, 90, 0, Math.PI * 2, true);
      c.fill();
    };

  });

</script>